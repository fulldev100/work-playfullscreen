/**
 * @license
 * Copyright (c) 2022 The Nuevodevel Team. All rights reserved.
 * Offline Plugin Version 2.0
 */
/* eslint-env node *//*eslint no-inner-declarations: "off"*/function _interopDefault(e){return e&&"object"===typeof e&&"default"in e?e.default:e}var videojs=_interopDefault(require("video.js"));try{videojs.options.vhs.maxPlaylistRetries=1}catch(e){console.log("e1")}try{videojs.options.errorDisplay=!1}catch(e){console.log("e2")}const defaults={offlineImage:"",offlineTimeout:30,liveSource:"",offlineCountdown:!1,liveStream:"",label:"restart",loadTimeout:0};function elint(e){return e}const registerPlugin=videojs.registerPlugin||videojs.plugin;try{videojs.options.vhs.maxPlaylistRetries=1}catch(e){elint(e)}try{videojs.options.errorDisplay=!1}catch(e){elint(e)}const onPlayerReady=(e,t)=>{function i(e){return e.charAt(0).toUpperCase()+e.slice(1)}t.label=i(t.label);var o,n=e.el(),l=!1,r=null,f=null,s=function(e,t){try{return e.querySelector(t)}catch(e){return!1}},a=s(n,".vjs-loading-spinner");if(""!==t.offlineImage){document.createElement("img").src=t.offlineImage;var c=s(n,".vjs-error-display");if(c)c.setAttribute("style","display:none!important");(r=document.createElement("div")).className="vjs-poster";r.setAttribute("style",'top:100%;z-index:15999;opacity:1!important;pointer-events:"none";background-color:#000;');n.appendChild(r);r.style.backgroundImage="url("+t.offlineImage+")";r.style.height=0;setInterval(function(){if(!e.isOffline){var t=n.className;if(t.indexOf("vjs-has-started")>-1)if(t.indexOf("vjs-ended")>-1){e.isOffline=!0;y()}}},500);if(t.loadTimeout>0)e.one("play",function(){setTimeout(function(){if(!0!==l){e.isOffline=!0;y()}},t.loadTimeout);e.one("loaddeddata",function(){l=!0})});e.on("error",function(){if(!e.isOffline){var t=e.error();if(1===t.code||2===t.code||4===t.code||3===t.code||-2===t.code){e.isOffline=!0;y()}}});e.offline.liveSource=function(e){t.liveStream=e};e.on("playing",function(){clearTimeout(o);if(a)a.removeAttribute("style");r.style.height=0;r.style.display="none";e.isOffline=!1;if(!0!==videojs.browser.IS_IOS)e.muted(!1);try{n.removeChild(f)}catch(e){elint(e)}f=null})}function u(){r.style.top=0;r.style.height="100%";r.style.display="block";if(t.offlineCountdown)if(null==f){(f=document.createElement("div")).setAttribute("style","position:absolute;right:30px;bottom:25px;font-size:20px;color:#fff;font-family:sans-serif,Arial;text-shadow:1px 1px 1px #000;z-Index:16000");n.appendChild(f)}}function d(){var t=e.play();if(void 0!==t)t.then(function(){return!0}).catch(function(t){e.muted(!0);e.play()})}function m(){u()}function p(t){e.src(t);e.load();d()}function y(){if(a)a.setAttribute("style","display:none!important");t.clock=0;if(!e.currentSource())e.currentSource={src:"playlist.m3u8"};t.liveStream=e.currentSource();m();function i(){clearTimeout(o);o=setTimeout(function(){t.clock++;if(t.offlineCountdown&&f)f.innerHTML=t.label+" "+v(t.offlineTimeout-t.clock);if(t.clock>=t.offlineTimeout){t.clock=0;e.trigger("offlineLoop");p(t.liveStream)}i()},1e3)}if(t.offlineCountdown)if(null!=f)f.innerHTML=t.label+" "+v(t.offlineTimeout);t.clock=0;i()}function v(e){var t=parseInt(e,10);return[Math.floor(t/3600),Math.floor(t/60)%60,t%60].map(e=>e<10?"0"+e:e).filter((e,t)=>"00"!==e||t>0).join(":")}},offline=function(e){this.ready(()=>{onPlayerReady(this,videojs.mergeOptions(defaults,e))})};registerPlugin("offline",offline);offline.VERSION="2.0";export default offline;